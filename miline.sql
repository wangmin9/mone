DROP TABLE IF EXISTS `miline_pipeline_sample`;
CREATE TABLE `miline_pipeline_sample` (
  `id` bigint(64) NOT NULL AUTO_INCREMENT,
  `sample_name` varchar(128) DEFAULT NULL,
  `status` int(4) DEFAULT NULL,
  `phase_setting` json DEFAULT NULL,
  `create_time` bigint(64) DEFAULT NULL,
  `desc` varchar(255) DEFAULT NULL,
  `sample_order` int(4) DEFAULT NULL,
  `type_id` int(4) DEFAULT NULL,
  `type_name` varchar(32) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin AUTO_INCREMENT=90002;

BEGIN;
INSERT INTO `miline_pipeline_sample` VALUES (1, '静态资源 • 构建、部署', 1, '[{\"phaseName\": null, \"phaseOrder\": 1, \"phaseTitle\": \"构建\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"StaticBuild\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"静态资源构建\"}]}, {\"phaseName\": null, \"phaseOrder\": 2, \"phaseTitle\": \"部署\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"StaticDeploy\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"静态资源部署\"}]}]', 0, NULL, 1, 4, '静态资源');
INSERT INTO `miline_pipeline_sample` VALUES (3, 'Java • 构建、镜像构建、部署', 1, '[{\"phaseName\": null, \"phaseOrder\": 1, \"phaseTitle\": \"Java构建\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"JavaBuild\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"Java构建\"}]}, {\"phaseName\": null, \"phaseOrder\": 2, \"phaseTitle\": \"docker镜像构建\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"MoneImageBuild\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"docker镜像构建\"}]}, {\"phaseName\": null, \"phaseOrder\": 3, \"phaseTitle\": \"米效部署\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"MoneDeploy\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"米效部署\"}]}]', 0, NULL, 2, 1, '米效docker部署');
INSERT INTO `miline_pipeline_sample` VALUES (4, 'Serverless • 构建function、发布', 1, '[{\"phaseName\": \"k8sJobFlow\", \"phaseOrder\": 1, \"phaseTitle\": \"其它\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": [{\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"image\\\": \\\"micr.cloud.mioffice.cn/wangzhidong1/checkout\\\"}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"image\\\": \\\"micr.cloud.mioffice.cn/wangzhidong1/maven-build\\\",\\\"subPath\\\": \\\"tesla/tesla-serverless-demo\\\"}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"uploadURL\\\": \\\"http://10.38.167.198:9999\\\",\\\"uploadName\\\": \\\"serverlesstest.jar\\\",\\\"image\\\": \\\"micr.cloud.mioffice.cn/wangzhidong1/uploadfile\\\",\\\"binPath\\\": \\\"tesla/tesla-serverless-demo/target/tesla-serverless-demo-1.0.0-SNAPSHOT.jar\\\"}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"image\\\": \\\"micr.cloud.mioffice.cn/wangzhidong1/clean-workspace\\\"}\"}}], \"templateName\": \"K8sJob\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"构建function\"}]}, {\"phaseName\": \"otherFlow\", \"phaseOrder\": 2, \"phaseTitle\": \"热更新\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": [{\"cname\": null, \"stepId\": 0, \"stepName\": \"serverlessHotUpdate\", \"stepOrder\": null, \"stepParams\": {\"methodName\": \"deployServerLessJar\", \"paramesArgs\": \"\", \"paramesTypes\": \"\", \"serviceGroup\": \"\", \"serviceName\": \"com.xiaomi.sautumn.api.service.SautumnService\", \"serviceVersion\": \"\"}}], \"templateName\": \"ServerlessHotUpdate\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"热更新\"}]}, {\"phaseName\": \"k8sJobFlow\", \"phaseOrder\": 3, \"phaseTitle\": \"其它\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": [{\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"_pipeline.deploy_name\\\": \\\"serverlesstest\\\",\\\"_pipeline.namespace\\\": \\\"mione-staging\\\",\\\"image\\\": \\\"cr.d.xiaomi.net/wangzhidong1/tesla-gateway:serverlessstaging\\\",\\\"server_less_jar_info\\\": \\\"serverlesstest.jar\\\",\\\"_pipeline.labels\\\": \\\"mione.autoScale=true\\\"}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"_pipeline.deploy_name\\\": \\\"serverlesstest\\\",\\\"_pipeline.namespace\\\": \\\"mione-staging\\\",\\\"type\\\": \\\"service\\\",\\\"_pipeline.service.tcp_ports\\\": \\\"8080:8080\\\",\\\"_pipeline.service.type\\\": \\\"clusterip\\\"}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\\"_pipeline.deploy_name\\\": \\\"serverlesstest\\\",\\\"_pipeline.namespace\\\": \\\"mione-staging\\\",\\\"type\\\": \\\"ingress\\\",\\\"_pipeline.ingress.host\\\": \\\"serverless.systech.test.b2c.srv\\\",\\\"_pipeline.ingress.paths\\\": \\\"function\\\",\\\"_pipeline.ingress.service_names\\\": \\\"serverlesstest\\\",\\\"_pipeline.ingress.service_ports\\\": \\\"8080\\\"}\"}}], \"templateName\": \"K8sJob\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"发布\"}]}]', 0, NULL, 6, 5, 'Serverless');
INSERT INTO `miline_pipeline_sample` VALUES (5, 'Mis平台服务 • k8s部署', 1, '[{\"phaseName\": \"k8sJobFlow\", \"phaseOrder\": 1, \"phaseTitle\": \"其它\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": [{\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\n    \\\"image\\\": \\\"MIONE/checkout\\\"\\n}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\n    \\\"image\\\": \\\"MIONE/dockerfile-image-build\\\",\\n    \\\"D_FILE_N\\\":\\\"dockerfile\\\",\\n    \\\"BUILD_ARG\\\":\\\"MODE=test\\\"\\n}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\n    \\\"image\\\": \\\"MIONE/clean-workspace\\\"\\n}\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_job\", \"stepOrder\": null, \"stepParams\": {\"k8sParam\": \"{\\n    \\\"type\\\": \\\"k8s\\\"\\n}\"}}], \"templateName\": \"K8sJob\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"K8s Job\"}]}]', 0, NULL, 5, 2, 'k8s');
INSERT INTO `miline_pipeline_sample` VALUES (30005, 'Java • 构建 • K8s部署', 1, '[{\"phaseName\": \"k8sJobFlow\", \"phaseOrder\": 1, \"phaseTitle\": \"编译\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": [{\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_checkout\", \"stepOrder\": null, \"stepParams\": {\"checkoutPath\": \"\", \"image\": \"MIONE/checkout\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_maven_build\", \"stepOrder\": null, \"stepParams\": {\"MVN_OPT\": \"\", \"buildProfile\": \"staging\", \"image\": \"MIONE/maven-build\", \"subPath\": \"\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_java_image_build\", \"stepOrder\": null, \"stepParams\": {\"fromImage\": \"\", \"image\": \"MIONE/java-image-build\", \"jarPath\": \"\"}}, {\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_clean_workspace\", \"stepOrder\": null, \"stepParams\": {\"image\": \"MIONE/clean-workspace\"}}], \"templateName\": \"K8sJob\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"K8s Job\"}]}, {\"phaseName\": \"k8sFlow\", \"phaseOrder\": 2, \"phaseTitle\": \"部署\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": [{\"cname\": null, \"stepId\": 0, \"stepName\": \"k8s_deploy\", \"stepOrder\": null, \"stepParams\": {\"JAVA_OPT\": \"\", \"OT_AGENT\": \"true\", \"_pipeline.deploy_cpu\": \"1\", \"_pipeline.deploy_memory\": \"2Gi\", \"_pipeline.envs\": \"\", \"_pipeline.log_path\": \"\", \"_pipeline.min_ready_seconds\": \"30\", \"_pipeline.probe\": \"\", \"_pipeline.replicas\": \"1\", \"_pipeline.sidecars\": \"\", \"init_scripts\": \"\", \"mione.kc_appid\": \"\", \"mione.kc_sidlist\": \"\", \"type\": \"k8s\"}}], \"templateName\": \"K8sDeploy\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"K8s部署\"}]}]', 1646297755449, '', 1, 2, 'k8s');
INSERT INTO `miline_pipeline_sample` VALUES (30006, 'Java • 流程规范检查、代码扫描、构建、镜像构建、部署', 1, '[{\"phaseName\": \"otherFlow\", \"phaseOrder\": 1, \"phaseTitle\": \"流程规范检查\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"NormativeCheck\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"流程规范检查\"}]}, {\"phaseName\": null, \"phaseOrder\": 1, \"phaseTitle\": \"Java代码扫描\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"MoneJavaCodecheck\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"Java代码扫描\"}]}, {\"phaseName\": null, \"phaseOrder\": 2, \"phaseTitle\": \"Java构建\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"JavaBuild\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"Java构建\"}]}, {\"phaseName\": null, \"phaseOrder\": 3, \"phaseTitle\": \"docker镜像构建\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"MoneImageBuild\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"docker镜像构建\"}]}, {\"phaseName\": null, \"phaseOrder\": 4, \"phaseTitle\": \"米效部署\", \"templateSetting\": [{\"cname\": null, \"stepSetting\": null, \"templateName\": \"MoneDeploy\", \"templateOrder\": 1, \"templateStatus\": 0, \"templateTitle\": \"米效部署\"}]}]', 1647422690414, '', 1, 1, '米效docker部署');
COMMIT;

DROP TABLE IF EXISTS `miline_step`;
CREATE TABLE `miline_step` (
  `id` int(32) NOT NULL AUTO_INCREMENT,
  `step_name` varchar(128) DEFAULT NULL,
  `step_cname` varchar(128) DEFAULT NULL,
  `defs` text DEFAULT NULL,
  `status` int(32) DEFAULT '0',
  `create_time` bigint(64) DEFAULT NULL,
  `update_time` bigint(64) DEFAULT NULL,
  `creator` varchar(64) DEFAULT NULL,
  `updater` varchar(64) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `k_step_name` (`step_name`),
  KEY `k_create_time` (`create_time`),
  UNIQUE KEY `step_name` (`step_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin AUTO_INCREMENT=213948;

BEGIN;
INSERT INTO `miline_step` VALUES (3, 'java_build', 'Java 构建', '[\n	{\n		\"cname\": \"JDK版本\",\n		\"pname\": \"jdkVersion\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"JDK 1.8\",\n				\"value\": \"openjdk1.8.0\"\n			},\n			{\n				\"label\": \"OPENJDK 11\",\n				\"value\": \"jdk-11.0.1\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"openjdk1.8.0\"\n	},\n	{\n		\"cname\": \"mvn库\",\n		\"pname\": \"mvnRepo\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"pkgs.d.xiaomi.net\",\n				\"value\": \"pkgs\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"pkgs\"\n	},\n	{\n		\"cname\": \"mvn参数\",\n		\"pname\": \"mvnCmd\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"默认已有-U clean package -Dmaven.test.skip=true\"\n	},\n	{\n		\"cname\": \"构建目录\",\n		\"pname\": \"buildPath\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"target目录\",\n		\"pname\": \"targetPath\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"profile\",\n		\"pname\": \"profile\",\n		\"type\": \"input\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"jar包别名\",\n		\"pname\": \"alias\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"pomGroupId\",\n		\"pname\": \"pomGroupId\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"pomArtifactId\",\n		\"pname\": \"pomArtifactId\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"pomVersion\",\n		\"pname\": \"pomVersion\",\n		\"type\": \"input\",\n		\"required\": false\n	}\n]', 1, 0, 1679369902419, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (7, 'add', 'add步骤', '[\n	{\n		\"cname\": \"JDK版本\",\n		\"pname\": \"jdkVersion\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"JDK 1.8\",\n				\"value\": \"openjdk1.8.0\"\n			},\n			{\n				\"label\": \"OPENJDK 11\",\n				\"value\": \"jdk-11.0.1\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"openjdk1.8.0\"\n	},\n	{\n		\"cname\": \"mvn库\",\n		\"pname\": \"mvnRepo\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"pkgs.d.xiaomi.net\",\n				\"value\": \"pkgs\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"pkgs\"\n	}\n]', 0, 1646205273125, 1677233736616, NULL, NULL);
INSERT INTO `miline_step` VALUES (11, 'scriptExec', '脚本执行', '[{\"cname\":\"脚本类型\",\"pname\":\"scriptType\",\"type\":\"select\",\"options\":[{\"label\":\"shell\",\"value\":\"shell\"},{\"label\":\"python\",\"value\":\"python\"}],\"required\":true,\"defaultValue\":\"shell\"},{\"cname\":\"script\",\"pname\":\"script\",\"type\":\"aceEditor\",\"required\":true},{\"cname\":\"脚本参数\",\"pname\":\"params\",\"type\":\"jsonParams\",\"required\":false}]', 1, 1646634932440, 1647329795439, NULL, NULL);
INSERT INTO `miline_step` VALUES (63948, 'mone_java_codecheck', 'Java代码扫描', '[ { \"cname\": \"JDK版本\", \"pname\": \"jdkVersion\", \"type\": \"select\", \"options\": [ { \"label\": \"JDK 1.8\", \"value\": \"openjdk1.8.0\" }, { \"label\": \"OPENJDK 11\", \"value\": \"jdk-11.0.1\" } ], \"required\": true, \"defaultValue\": \"openjdk1.8.0\" }, { \"cname\": \"mvn库\", \"pname\": \"mvnRepo\", \"type\": \"select\", \"options\": [ { \"label\": \"pkgs.d.xiaomi.net\", \"value\": \"pkgs\" } ], \"required\": true, \"defaultValue\": \"pkgs\" } ]', 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63949, 'sonar_frontend_codecheck', 'Sonar前端代码扫描', '[\n	{\n		\"cname\": \"JDK版本\",\n		\"pname\": \"jdkVersion\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"JDK 1.8\",\n				\"value\": \"JDK 1.8\"\n			},\n			{\n				\"label\": \"OPENJDK 11\",\n				\"value\": \"OPENJDK 11\"\n			}\n		],\n		\"required\": true\n	},\n	{\n		\"cname\": \"mvn版本\",\n		\"pname\": \"mvnVersion\",\n		\"type\": \"input\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"projectKey\",\n		\"pname\": \"projectKey\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"profile\",\n		\"pname\": \"profile\",\n		\"type\": \"input\",\n		\"required\": false\n	}\n]', 1, 0, 1668578807141, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63950, 'sonar_java_codecheck', 'Sonar Java代码扫描', '[\n	{\n		\"cname\": \"maven profile\",\n		\"pname\": \"mvnProfile\",\n		\"type\": \"input\",\n		\"required\": false\n	}\n]', 1, 0, 1668590594341, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63951, 'mone_image_build', 'docker镜像构建', '[\n	{\n		\"cname\": \"cpu\",\n		\"pname\": \"cpuNum\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true,\n		\"minValue\": \"1\"\n	},\n	{\n		\"cname\": \"内存(M)\",\n		\"pname\": \"mem\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1024\",\n		\"required\": true,\n		\"maxValue\": \"1400\",\n		\"minValue\": \"1024\"\n	},\n	{\n		\"cname\": \"日志路径\",\n		\"pname\": \"logPath\",\n		\"type\": \"input\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"数据卷\",\n		\"pname\": \"dockerVolume\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"自定义环境变量\",\n		\"pname\": \"dockerParams\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"自定义启动命令\",\n		\"pname\": \"initScript\",\n		\"type\": \"textarea\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"jvm参数\",\n		\"pname\": \"jvmParams\",\n		\"type\": \"textarea\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"健康检查\",\n		\"pname\": \"healthCheckUrl\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"https://wiki.n.miui.com/pages/viewpage.action?pageId=572307640\"\n	},\n	{\n		\"cname\": \"开启链路追踪\",\n		\"pname\": \"jaeger\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": false,\n		\"ajax\": {\n			\"ajaxUrl\": \"https://miline.test.mi.com/api/miline/review/users\",\n			\"ajaxType\": \"GET\",\n			\"ajaxParams\": \"{\\\"projectId\\\":\\\"123\\\", \\\"env\\\":\\\"staging\\\"}\"\n		}\n	},\n	{\n		\"cname\": \"优雅下线\",\n		\"pname\": \"gracefulShutdown\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": false,\n		\"tooltips\": \"在容器停止前，主动下线该服务的所有dubbo provider\"\n	},\n	{\n		\"cname\": \"labels\",\n		\"pname\": \"labels\",\n		\"type\": \"textarea\",\n		\"required\": false,\n		\"tooltips\": \"支持标签说明：\\n暴露端口相关标签，支持暴露3个端口：\\n http_port=端口号\\n dubbo_port=端口号\\n third_port=端口号\\n port=aa&bb&cc\\n 注：端口号为应用中指定的端口，若为-1时不指定\\n 需要keycenter：\\n keycenter=true\"\n	}\n]', 1, 0, 1677232425039, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63952, 'dockerfile_image_build', 'dockerfile镜像构建', '[\n	{\n		\"cname\": \"profile\",\n		\"pname\": \"mvnProfile\",\n		\"type\": \"input\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"cpu\",\n		\"pname\": \"cpuNum\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true,\n		\"minValue\": \"1\"\n	},\n	{\n		\"cname\": \"内存(M)\",\n		\"pname\": \"mem\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1024\",\n		\"required\": true,\n		\"minValue\": \"1024\"\n	},\n	{\n		\"cname\": \"日志路径\",\n		\"pname\": \"logPath\",\n		\"type\": \"input\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"数据卷\",\n		\"pname\": \"dockerVolume\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"dockerfile目录\",\n		\"pname\": \"dockerfilePath\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"自定义环境变量\",\n		\"pname\": \"dockerParams\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"健康检查\",\n		\"pname\": \"healthCheckUrl\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"labels\",\n		\"pname\": \"labels\",\n		\"type\": \"input\",\n		\"required\": false\n	}\n]', 1, 0, 1677232415115, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63953, 'k8s_deploy', 'K8s部署', '[\n	{\n		\"cname\": \"类型\",\n		\"pname\": \"type\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"default\",\n				\"value\": \"k8s\"\n			},\n			{\n				\"label\": \"daemonset\",\n				\"value\": \"daemonset\"\n			},\n			{\n				\"label\": \"statefulset\",\n				\"value\": \"statefulset\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"k8s\"\n	},\n	{\n		\"cname\": \"实例数\",\n		\"pname\": \"_pipeline.replicas\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"cpu\",\n		\"pname\": \"_pipeline.deploy_cpu\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true,\n		\"minValue\": \"1\"\n	},\n	{\n		\"cname\": \"容器内存（Mi）\",\n		\"pname\": \"_pipeline.deploy_memory\",\n		\"type\": \"number\",\n		\"defaultValue\": 2048,\n		\"required\": true,\n		\"maxValue\": 40960,\n		\"minValue\": 1024,\n		\"handleFn\": \"function(val) { if (typeof val == \'number\' || !val) { return val || \'\'}; const num = val.toLowerCase();  const param = {  \'g\': 1000, \'gi\': 1024,  \'m\': 1,  \'mi\': 1.024,  \'k\': 1 / 1000,  \'ki\': 1 / 1024 }; return parseInt(num) * (param[num.replace(/[^a-zA-Z]/g,\'\')] || 1)}\"\n	},\n	{\n		\"cname\": \"jvm参数\",\n		\"pname\": \"JAVA_OPT\",\n		\"type\": \"textarea\",\n		\"required\": false,\n		\"tooltips\": \"默认包含了\'-XX:MaxRAMPercentage=75.00 -XX:+UseG1GC -XX:+PrintReferenceGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintHeapAtGC -Xloggc:/root/gc.log\'\"\n	},\n	{\n		\"cname\": \"开启链路追踪\",\n		\"pname\": \"OT_AGENT\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": true\n	},\n	{\n		\"cname\": \"开启自动扩缩容\",\n		\"pname\": \"autoCapacity\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": false\n	},\n	{\n		\"cname\": \"自动扩缩容,目标cpu使用率(%))\",\n		\"pname\": \"_deploy.autoscale\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"defaultValue\": 0\n	},\n	{\n		\"cname\": \"日志路径\",\n		\"pname\": \"_pipeline.log_path\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"/home/work/log中的下级目录名称\"\n	},\n	{\n		\"cname\": \"keycenter k8AppId (mione.kc_appid)\",\n		\"pname\": \"mione.kc_appid\",\n		\"type\": \"select\",\n		\"required\": false,\n		\"tooltips\": \"使用方式参照文档，已激活的sid可直接选择\",\n		\"optionLabel\": [\n			\"sidList\",\n			\"k8sAppId\"\n		],\n		\"optionValue\": \"id\",\n		\"ajax\": {\n			\"ajaxUrl\": \"/api/miline/project/kc/list\",\n			\"ajaxType\": \"POST\",\n			\"ajaxParams\": \"{\\\"env\\\":\\\"staging\\\",\\\"status\\\":\\\"1\\\",\\\"projectId\\\":\\\"123\\\"}\"\n		},\n		\"allowCreate\": false\n	},\n	{\n		\"cname\": \"keycenter sid list (mione.kc_sidlist,miline初始化用)\",\n		\"pname\": \"mione.kc_sidlist\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"使用方式参照文档，使用miline初始化的sid请填写此处\"\n	},\n	{\n		\"cname\": \"部署超时时间(秒)\",\n		\"pname\": \"_k8s.deploy_timeout\",\n		\"type\": \"number\",\n		\"defaultValue\": 60,\n		\"required\": false,\n		\"maxValue\": 300,\n		\"minValue\": 1\n	},\n	{\n		\"cname\": \"sidecar挂载\",\n		\"pname\": \"_pipeline.sidecars\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"支持 soa-agent-test,soa-agent-online,toolbox,redis 将sidecar的名字用逗号隔开即可\\nsoa-agent-test和soa-agent-online分别为staging环境和线上环境的soa-agent\\n toolbox中支持一些常用的网络工具命令和mysql-cli\"\n	},\n	{\n		\"cname\": \"自定义sidecar\",\n		\"pname\": \"sidecarIds\",\n		\"type\": \"select\",\n		\"required\": false,\n		\"multiple\": true,\n		\"optionLabel\": \"name\",\n		\"optionValue\": \"id\",\n		\"ajax\": {\n			\"ajaxUrl\": \"/api/miline/list_sidecar\",\n			\"ajaxType\": \"GET\",\n			\"ajaxParams\": \"{\\\"env\\\":\\\"staging\\\"}\"\n		},\n		\"tooltips\": \"在 我的头像—>sidecar中上传要添加的自定义sidecar\"\n	},\n	{\n		\"cname\": \"最小服务稳定时间\",\n		\"pname\": \"_pipeline.min_ready_seconds\",\n		\"type\": \"number\",\n		\"defaultValue\": \"30\",\n		\"required\": false,\n		\"minValue\": \"0\",\n		\"tooltips\": \"服务就绪且最小服务稳定时间后，认为服务稳定。\\n更新时，新实例稳定后才会下线老实例.。\\n建议使用就绪检查，可用性判断更精确\"\n	},\n	{\n		\"cname\": \"就绪检查(k8s probe)\",\n		\"pname\": \"_pipeline.probe\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"支持对tcp和http get请求的检测，tcp检测端口是否开放，http get请求检测状态码是否为200-399。配置方式：\\\"tcp,端口号\\\"或\\\"http,端口号,http请求path\\\"\\n新部署的dubbo服务请把端口配置为20880(tcp,20880)\\n若不配置此项默认服务启动成功后就绪\"\n	},\n	{\n		\"cname\": \"自定义环境变量\",\n		\"pname\": \"_pipeline.envs\",\n		\"type\": \"textarea\",\n		\"required\": false,\n		\"tooltips\": \"请填写json格式，e.g. \\n{\\\"use.host.ip\\\":\\\"true\\\"}\"\n	},\n	{\n		\"cname\": \"弹性策略\",\n		\"pname\": \"_pipeline.zone\",\n		\"type\": \"radioGroup\",\n		\"autoValue\": {\n			\"staging\": \"auto\",\n			\"online\": \"all\"\n		},\n		\"options\": [\n			{\n				\"label\": \"双机房均衡\",\n				\"value\": \"double\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"单机房\",\n				\"value\": \"single\",\n				\"env\": [\n					\"online\",\n					\"staging\"\n				]\n			},\n			{\n				\"label\": \"自由弹性\",\n				\"value\": \"auto\",\n				\"env\": [\n					\"online\",\n					\"staging\"\n				]\n			}\n		],\n		\"required\": true,\n		\"secondOptions\": [\n			{\n				\"label\": \"c3\",\n				\"value\": \"c3\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"miks-ali\",\n				\"value\": \"miks-ali\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"ack\",\n				\"value\": \"ack\",\n				\"hideKey\": [\n					\"double\",\n					\"auto\"\n				],\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"staging\",\n				\"value\": \"all\",\n				\"env\": [\n					\"staging\"\n				]\n			},\n			{\n				\"label\": \"tj1\",\n				\"value\": \"tj1:mione-staging\",\n				\"hideKey\": [\n					\"double\",\n					\"auto\"\n				],\n				\"env\": [\n					\"staging\"\n				]\n			}\n		]\n	},\n	{\n		\"cname\": \"启动前执行命令\",\n		\"pname\": \"init_scripts\",\n		\"type\": \"textarea\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"PVC\",\n		\"pname\": \"_pipeline.pvcs\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"容器关闭等待时间\",\n		\"pname\": \"_k8s.grace_term_time\",\n		\"type\": \"number\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"优雅下线\",\n		\"pname\": \"_pipeline.gracefulShutdown\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": false,\n		\"tooltips\": \"在容器停止前，主动下线该服务的所有dubbo provider\"\n	},\n	{\n		\"cname\": \"configMap\",\n		\"pname\": \"_pipeline.configmaps\",\n		\"type\": \"select\",\n		\"required\": false,\n		\"validatorEmitterKey\": \"checkConfigMapForm\",\n		\"validator\": \"function(value) {let isValid=true; let data=[]; if(value && typeof value==\'string\'){data=JSON.parse(value);}else{data=value;}if (!data.length) return isValid;data.forEach(item=>{ if(item.conigMapName&&!item.ref.length){ isValid=false; }else if(item.ref.length){ item.ref.forEach(item2=>{ if(!item2.mountPath||!new RegExp(\'^/\').test(item2.mountPath)){ isValid=false; }})}}); return isValid;}\",\n		\"ajax\": {\n			\"ajaxUrl\": \"/api/miline/k8s/configMap/list\",\n			\"ajaxType\": \"GET\",\n			\"ajaxParams\": \"{\\\"projectId\\\":\\\"123\\\", \\\"env\\\":\\\"staging\\\"}\"\n		},\n		\"showEnv\": \"staging\"\n	},\n	{\n		\"cname\": \"\",\n		\"pname\": \"_pipeline.faas.sidecar.env\",\n		\"required\": false,\n		\"optionLabel\": \"name\",\n		\"optionValue\": \"id\",\n		\"showEnv\": \"staging\",\n		\"ajax\": {\n			\"ajaxUrl\": \"/mtop/tesla/faas/func/create\",\n			\"stagingDomain\": \"https://xmmionegw-outer.test.mi.com\",\n			\"onlineDomain\": \"\",\n			\"ajaxType\": \"POST\",\n			\"ajaxParams\": \"[{\\\"account\\\":\\\"wangmin17\\\",\\\"userType\\\":\\\"0\\\"},{\\\"module\\\":\\\"sidecarMoudle_${id}\\\",\\\"packageName\\\":\\\"com.xiaomi.sidecar\\\",\\\"funcName\\\":\\\"sidecarFunc_${id}\\\",\\\"projectId\\\":90707,\\\"funcType\\\":\\\"CODE\\\",\\\"funcClass\\\":\\\"1\\\"}]\"\n		},\n		\"children\": {\n			\"cname\": \"sidecar env\",\n			\"pname\": \"_pipeline.faas.sidecar.env\",\n			\"tooltips\": \"流水线id存在才能创建faas sidecar，请保存后再选择env\",\n			\"type\": \"select\",\n			\"required\": false,\n			\"defaultValue\": false,\n			\"optionLabel\": \"name\",\n			\"optionValue\": \"id\",\n			\"ajax\": {\n				\"ajaxUrl\": \"/mtop/tesla/faas/func/qry\",\n				\"stagingDomain\": \"https://xmmionegw-outer.test.mi.com\",\n				\"onlineDomain\": \"\",\n				\"ajaxType\": \"POST\",\n				\"ajaxParams\": \"[{\\\"account\\\":\\\"wangmin17\\\",\\\"userType\\\":\\\"0\\\"},{\\\"id\\\":\\\"FassSidecarValue\\\",\\\"module\\\":\\\"sidecarMoudle_${id}\\\",\\\"packageName\\\":\\\"com.xiaomi.sidecar\\\",\\\"funcName\\\":\\\"sidecarFunc_${id}\\\",\\\"projectId\\\":90707,\\\"funcType\\\":\\\"CODE\\\",\\\"funcClass\\\":\\\"1\\\"}]\"\n			}\n		},\n		\"hidden\": true\n	}\n]', 1, 0, 1690786436775, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63955, 'k8s_job', 'k8s任务', '[ { \"cname\": \"k8s参数\", \"pname\": \"k8sParam\", \"type\": \"jsonEdit\",  \"required\": true } ]', 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63956, 'mone_deploy', 'docker部署', '[\n	{\n		\"cname\": \"部署机房\",\n		\"pname\": \"tenement\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"中国区\",\n				\"value\": \"first_dept\"\n			},\n			{\n				\"label\": \"创新部\",\n				\"value\": \"innov_dept\"\n			},\n			{\n				\"label\": \"信息部\",\n				\"value\": \"info-mici\"\n			},\n			{\n				\"label\": \"有品\",\n				\"value\": \"youpin\"\n			}\n		],\n		\"required\": true\n	},\n	{\n		\"cname\": \"弹性策略（目前online环境c3/c4机器比例大约为7:3，无法保证满足双机房均衡）\",\n		\"pname\": \"cluster\",\n		\"required\": true,\n		\"type\": \"radioGroup\",\n		\"autoValue\": {\n			\"staging\": \"all\",\n			\"online\": \"all\"\n		},\n		\"options\": [\n			{\n				\"label\": \"双机房均衡\",\n				\"value\": \"double\",\n				\"env\": [\n					\"staging\",\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"单机房\",\n				\"value\": \"single\",\n				\"env\": [\n					\"staging\",\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"自由弹性\",\n				\"value\": \"auto\",\n				\"env\": [\n					\"staging\",\n					\"online\"\n				]\n			}\n		],\n		\"secondOptions\": [\n			{\n				\"label\": \"c3\",\n				\"value\": \"c3\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"c4\",\n				\"value\": \"c4\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"staging\",\n				\"value\": \"all\",\n				\"env\": [\n					\"staging\"\n				]\n			},\n			{\n				\"label\": \"ksywq\",\n				\"value\": \"ksywq\",\n				\"env\": [\n					\"staging\"\n				]\n			}\n		]\n	},\n	{\n		\"cname\": \"实例数\",\n		\"pname\": \"num\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true,\n		\"minValue\": \"1\"\n	},\n	{\n		\"cname\": \"发布方式\",\n		\"pname\": \"policyDeploymentType\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"分批发布\",\n				\"value\": \"oneByone\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"oneByone\"\n	},\n	{\n		\"cname\": \"发布暂停方式\",\n		\"pname\": \"policyStop\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"每批暂停\",\n				\"value\": \"each\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"each\"\n	},\n	{\n		\"cname\": \"发布批次\",\n		\"pname\": \"policyBatchNum\",\n		\"type\": \"number\",\n		\"defaultValue\": \"2\",\n		\"required\": true,\n		\"minValue\": \"1\",\n		\"tooltips\": \"除去堡垒批次外的批次数\"\n	},\n	{\n		\"cname\": \"quota\",\n		\"pname\": \"quota\",\n		\"type\": \"select\",\n		\"required\": false,\n		\"optionLabel\": \"resourceName\",\n		\"optionValue\": \"id\",\n		\"ajax\": {\n			\"ajaxUrl\": \"https://miline.test.mi.com/api/miline/tpc/resourcePoolList\",\n			\"ajaxType\": \"GET\",\n			\"ajaxParams\": \"{\\\"projectId\\\":\\\"123\\\", \\\"env\\\":\\\"staging\\\", \\\"resourceType\\\":\\\"9\\\"}\"\n		},\n		\"showEnv\": \"no\"\n	}\n]', 1, 0, 1686123041190, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63957, 'dubboInvoke', 'dubbo服务', '[{\"cname\":\"serviceName\",\"pname\":\"serviceName\",\"type\":\"input\",\"required\":true},{\"cname\":\"serviceVersion\",\"pname\":\"serviceVersion\",\"type\":\"input\",\"required\":false},{\"cname\":\"serviceGroup\",\"pname\":\"serviceGroup\",\"type\":\"input\",\"required\":false},{\"cname\":\"methodName\",\"pname\":\"methodName\",\"type\":\"input\",\"required\":true},{\"cname\":\"paramesTypes\",\"pname\":\"paramesTypes\",\"type\":\"textarea\",\"required\":false},{\"cname\":\"paramesArgs\",\"pname\":\"paramesArgs\",\"type\":\"textarea\",\"required\":false}]', 1, 0, 1649311717661, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63958, 'http_remote', 'http服务', '[ { \"cname\": \"请求方式\", \"pname\": \"postType\", \"type\": \"select\",  \"options\": [ { \"label\": \"GET\", \"value\": \"GET\" }], \"required\": true } ]', 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (63959, 'static_deploy', '静态资源部署', '[{\"cname\":\"accessKeyEnvKey\",\"pname\":\"accessKeyEnvKey\",\"type\":\"input\",\"required\":true},{\"cname\":\"accessSecretEnvKey\",\"pname\":\"accessSecretEnvKey\",\"type\":\"input\",\"required\":true},{\"cname\":\"发布命令\",\"pname\":\"deployCmd\",\"type\":\"textarea\",\"required\":true},{\"cname\":\"自定义环境变量\",\"pname\":\"dockerParams\",\"type\":\"jsonEdit\",\"required\":false},{\"cname\":\"测试特殊角色显示\",\"pname\":\"test\",\"type\":\"input\",\"role\":\"11\"}]', 1, 0, 1649230045842, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (69960, 'static_build', '静态资源编译', '[\n	{\n		\"cname\": \"Node版本\",\n		\"pname\": \"nodeVersion\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"16.17.1\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:16.17.1\"\n			},\n			{\n				\"label\": \"15.10.0\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:15.10.0\"\n			},\n			{\n				\"label\": \"14.16.0\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:14.16.0\"\n			},\n			{\n				\"label\": \"13.14.0\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:13.14.0\"\n			},\n			{\n				\"label\": \"12.21.0\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:12.21.0\"\n			},\n			{\n				\"label\": \"10.24.0\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:10.24.0\"\n			},\n			{\n				\"label\": \"8.9.3\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:8.9.3\"\n			},\n			{\n				\"label\": \"6.11.4\",\n				\"value\": \"cr.d.xiaomi.net/mixiao/node:6.11.4\"\n			}\n		],\n		\"required\": true\n	},\n	{\n		\"cname\": \"构建命令\",\n		\"pname\": \"buildCmd\",\n		\"type\": \"textarea\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"自定义环境变量\",\n		\"pname\": \"dockerParams\",\n		\"type\": \"jsonEdit\",\n		\"required\": false\n	}\n]', 1, 0, 1664276802745, 'admin', 'admin');
INSERT INTO `miline_step` VALUES (93948, 'k8s_maven_build', 'K8s maven项目构建', '[\n	{\n		\"cname\": \"环境\",\n		\"pname\": \"image\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"maven-3.8-jdk-8\",\n				\"value\": \"MIONE/maven-build\"\n			},\n			{\n				\"label\": \"maven-3.8-jdk-11\",\n				\"value\": \"MIONE/maven-build:11\"\n			},\n			{\n				\"label\": \"maven-3.8-jdk-19\",\n				\"value\": \"MIONE/maven-build:19\"\n			},\n			{\n				\"label\": \"maven-mesh\",\n				\"value\": \"MIONE/maven-build:mesh\"\n			},\n			{\n				\"label\": \"maven-mesh2\",\n				\"value\": \"MIONE/maven-build:mesh2\"\n			},\n			{\n				\"label\": \"maven-cmd\",\n				\"value\": \"MIONE/maven-build:cmd\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"MIONE/maven-build\"\n	},\n	{\n		\"cname\": \"profile\",\n		\"pname\": \"buildProfile\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"mvn参数\",\n		\"pname\": \"MVN_OPT\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"默认已有-U clean package -Dmaven.test.skip=true --no-transfer-progress\"\n	},\n	{\n		\"cname\": \"工作目录\",\n		\"pname\": \"subPath\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"\",\n		\"showName\": \"开启faas sidecar\",\n		\"pname\": \"_pipeline.faas.sidecar.func\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"showEnv\": \"staging\",\n		\"templateTips\": \"请保存后再开启\",\n		\"disabledTips\": \"所属项目组为默认项目组不可开启faas sidecar，请编辑项目修改后再开启\"\n	},\n	{\n		\"cname\": \"\",\n		\"pname\": \"_pipeline.faas.sidecar.env\",\n		\"ifShowValue\": true,\n		\"ifShowValueName\": \"_pipeline.faas.sidecar.func\",\n		\"required\": false,\n		\"optionLabel\": \"name\",\n		\"optionValue\": \"id\",\n		\"showEnv\": \"staging\",\n		\"ajax\": {\n			\"ajaxUrl\": \"/mtop/tesla/faas/func/create\",\n			\"ajaxType\": \"POST\",\n			\"stagingDomain\": \"https://xmmionegw-outer.test.mi.com\",\n			\"onlineDomain\": \"\",\n			\"ajaxParams\": \"[{\\\"account\\\":\\\"wangmin17\\\",\\\"userType\\\":\\\"0\\\"},{\\\"module\\\":\\\"sidecarMoudle_${id}\\\",\\\"packageName\\\":\\\"com.xiaomi.sidecar\\\",\\\"funcName\\\":\\\"sidecarFunc_${id}\\\",\\\"projectId\\\":90707,\\\"funcType\\\":\\\"CODE\\\",\\\"funcClass\\\":\\\"1\\\"}]\"\n		},\n		\"children\": {\n			\"cname\": \"sidecar env\",\n			\"pname\": \"_pipeline.faas.sidecar.env\",\n			\"tooltips\": \"流水线id存在才能创建faas.sidecar，请保存后再选择env\",\n			\"type\": \"select\",\n			\"required\": false,\n			\"defaultValue\": false,\n			\"optionLabel\": \"name\",\n			\"optionValue\": \"id\",\n			\"ajax\": {\n				\"ajaxUrl\": \"/mtop/tesla/faas/func/qry\",\n				\"ajaxType\": \"POST\",\n				\"stagingDomain\": \"https://xmmionegw-outer.test.mi.com\",\n				\"onlineDomain\": \"\",\n				\"ajaxParams\": \"[{\\\"account\\\":\\\"wangmin17\\\",\\\"userType\\\":\\\"0\\\"},{\\\"id\\\":\\\"FassSidecarValue\\\",\\\"module\\\":\\\"sidecarMoudle_${id}\\\",\\\"packageName\\\":\\\"com.xiaomi.sidecar\\\",\\\"funcName\\\":\\\"sidecarFunc_${id}\\\",\\\"projectId\\\":90707,\\\"funcType\\\":\\\"CODE\\\",\\\"funcClass\\\":\\\"1\\\"}]\"\n			}\n		}\n	},\n	{\n		\"cname\": \"sidecar镜像\",\n		\"pname\": \"_pipeline.faas.sidecar.image\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"showByStepNAmeVal\": true,\n		\"showByStepName\": \"_pipeline.faas.sidecar.func\"\n	},\n	{\n		\"cname\": \"pre command\",\n		\"pname\": \"preCMD\",\n		\"type\": \"input\",\n		\"required\": false\n	}\n]', 1, 1651903527961, 1686206742330, NULL, NULL);
INSERT INTO `miline_step` VALUES (93949, 'k8s_java_image_build', 'K8s java镜像构建', '[{\"cname\":\"类型\",\"pname\":\"image\",\"type\":\"select\",\"options\":[{\"label\":\"default\",\"value\":\"MIONE/java-image-build\"}],\"required\":true,\"defaultValue\":\"MIONE/java-image-build\"},{\"cname\":\"jar文件路径\",\"pname\":\"jarPath\",\"type\":\"input\",\"required\":true,\"defaultValue\":\"target/*.jar\",\"tooltips\":\"编译出的jar包的相对路径（相对工作区目录）地址，如果编译结果目录下只包含一个jar文件，可以使用“*.jar”的方式进行模糊匹配，否则需要指定完整的jar文件名称\"},{\"cname\":\"基础镜像\",\"pname\":\"fromImage\",\"type\":\"input\",\"required\":false,\"tooltips\":\"默认为mione团队提供的java 8镜像\"}]', 1, 1651911147755, 1651911147755, NULL, NULL);
INSERT INTO `miline_step` VALUES (93950, 'k8s_checkout', 'k8s下载代码', '[{\"cname\":\"类型\",\"pname\":\"image\",\"type\":\"select\",\"options\":[{\"label\":\"default\",\"value\":\"MIONE/checkout\"}],\"required\":true,\"defaultValue\":\"MIONE/checkout\"},{\"cname\":\"代码保存到子目录\",\"pname\":\"checkoutPath\",\"type\":\"input\",\"required\":false}]', 1, 1652067875394, 1652067875394, NULL, NULL);
INSERT INTO `miline_step` VALUES (93951, 'k8s_clean_workspace', 'K8s清理任务', '[{\"cname\":\"类型\",\"pname\":\"image\",\"type\":\"select\",\"options\":[{\"label\":\"default\",\"value\":\"MIONE/clean-workspace\"}],\"required\":true,\"defaultValue\":\"MIONE/clean-workspace\"}]', 1, 1652165040892, 1652165040892, NULL, NULL);
INSERT INTO `miline_step` VALUES (123948, 'k8s_gray_deploy', 'K8s灰度部署', '[\n	{\n		\"cname\": \"类型\",\n		\"pname\": \"type\",\n		\"type\": \"select\",\n		\"options\": [\n			{\n				\"label\": \"default\",\n				\"value\": \"grayDeploy\"\n			}\n		],\n		\"required\": true,\n		\"defaultValue\": \"grayDeploy\"\n	},\n	{\n		\"cname\": \"实例数\",\n		\"pname\": \"_pipeline.replicas\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true\n	},\n	{\n		\"cname\": \"发布批次\",\n		\"pname\": \"_pipeline.gray_batch\",\n		\"type\": \"number\",\n		\"defaultValue\": \"2\",\n		\"required\": true,\n		\"minValue\": \"2\",\n		\"maxValue\": \"7\"\n	},\n	{\n		\"cname\": \"cpu\",\n		\"pname\": \"_pipeline.deploy_cpu\",\n		\"type\": \"number\",\n		\"defaultValue\": \"1\",\n		\"required\": true,\n		\"minValue\": \"1\"\n	},\n	{\n		\"cname\": \"容器内存（Mi）\",\n		\"pname\": \"_pipeline.deploy_memory\",\n		\"type\": \"number\",\n		\"defaultValue\": 2048,\n		\"required\": true,\n		\"maxValue\": 40960,\n		\"minValue\": 1024,\n		\"handleFn\": \"function(val) { if (typeof val == \'number\' || !val) { return val || \'\'}; const num = val.toLowerCase();  const param = {  \'g\': 1000, \'gi\': 1024,  \'m\': 1,  \'mi\': 1.024,  \'k\': 1 / 1000,  \'ki\': 1 / 1024 }; return parseInt(num) * (param[num.replace(/[^a-zA-Z]/g,\'\')] || 1)}\"\n	},\n	{\n		\"cname\": \"jvm参数\",\n		\"pname\": \"JAVA_OPT\",\n		\"type\": \"textarea\",\n		\"required\": false,\n		\"tooltips\": \"默认包含了\'-XX:MaxRAMPercentage=75.00 -XX:+UseG1GC -XX:+PrintReferenceGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintHeapAtGC -Xloggc:/root/gc.log\'\"\n	},\n	{\n		\"cname\": \"开启链路追踪\",\n		\"pname\": \"OT_AGENT\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": true\n	},\n	{\n		\"cname\": \"开启自动扩缩容\",\n		\"pname\": \"autoCapacity\",\n		\"type\": \"switch\",\n		\"required\": false,\n		\"defaultValue\": false\n	},\n	{\n		\"cname\": \"日志路径\",\n		\"pname\": \"_pipeline.log_path\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"/home/work/log中的下级目录名称\"\n	},\n	{\n		\"cname\": \"keycenter appid\",\n		\"pname\": \"mione.kc_appid\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"使用方式参照文档，使用流水线初始化的sid请填写此处\"\n	},\n	{\n		\"cname\": \"keycenter sid list\",\n		\"pname\": \"mione.kc_sidlist\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"使用方式参照文档，使用miline初始化的sid请填写此处\",\n		\"hidden\": true\n	},\n	{\n		\"cname\": \"部署超时时间(秒)\",\n		\"defaultValue\": 60,\n		\"maxValue\": 300,\n		\"minValue\": 1,\n		\"pname\": \"_k8s.deploy_timeout\",\n		\"required\": false,\n		\"type\": \"number\"\n	},\n	{\n		\"cname\": \"sidecar挂载\",\n		\"pname\": \"_pipeline.sidecars\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"支持 soa-agent-test,soa-agent-online,toolbox,redis 将sidecar的名字用逗号隔开即可\\nsoa-agent-test和soa-agent-online分别为staging环境和线上环境的soa-agent\\n toolbox中支持一些常用的网络工具命令和mysql-cli\"\n	},\n	{\n		\"cname\": \"自定义sidecar\",\n		\"pname\": \"sidecarIds\",\n		\"type\": \"select\",\n		\"required\": false,\n		\"multiple\": true,\n		\"optionLabel\": \"name\",\n		\"optionValue\": \"id\",\n		\"ajax\": {\n			\"ajaxUrl\": \"https://miline.test.mi.com/api/miline/list_sidecar\",\n			\"ajaxType\": \"GET\",\n			\"ajaxParams\": \"{\\\"env\\\":\\\"staging\\\"}\"\n		},\n		\"tooltips\": \"在 我的头像—>sidecar中上传要添加的自定义sidecar\"\n	},\n	{\n		\"cname\": \"最小服务可用时间\",\n		\"pname\": \"_pipeline.min_ready_seconds\",\n		\"type\": \"number\",\n		\"defaultValue\": \"30\",\n		\"required\": false,\n		\"minValue\": \"0\",\n		\"tooltips\": \"最小服务可用时间后，认为服务可用。更新时，新实例可用后才会下线老实例.。\\n建议使用可用性检查，可用性判断更精确\"\n	},\n	{\n		\"cname\": \"可用性检查\",\n		\"pname\": \"_pipeline.probe\",\n		\"type\": \"input\",\n		\"required\": false,\n		\"tooltips\": \"支持对tcp和http get请求的检测，tcp检测端口是否开放，http get请求检测状态码是否为200-399。配置方式：\\\"tcp,端口号\\\"或\\\"http,端口号,http请求path\\\"\\n配置此项将禁用最小服务可用时间\"\n	},\n	{\n		\"cname\": \"自定义环境变量\",\n		\"pname\": \"_pipeline.envs\",\n		\"type\": \"textarea\",\n		\"required\": false,\n		\"tooltips\": \"请填写json格式，e.g. \\n{\\\"use.host.ip\\\":\\\"true\\\"}\"\n	},\n	{\n		\"cname\": \"弹性策略\",\n		\"pname\": \"_pipeline.zone\",\n		\"type\": \"radioGroup\",\n		\"autoValue\": {\n			\"staging\": \"auto\",\n			\"online\": \"all\"\n		},\n		\"options\": [\n			{\n				\"label\": \"双机房均衡\",\n				\"value\": \"double\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"单机房\",\n				\"value\": \"single\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"自由弹性\",\n				\"value\": \"auto\",\n				\"env\": [\n					\"staging\",\n					\"online\"\n				]\n			}\n		],\n		\"required\": true,\n		\"secondOptions\": [\n			{\n				\"label\": \"c3\",\n				\"value\": \"c3\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"miks-ali\",\n				\"value\": \"miks-ali\",\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"ack\",\n				\"value\": \"ack\",\n				\"hideKey\": [\"double\"],\n				\"env\": [\n					\"online\"\n				]\n			},\n			{\n				\"label\": \"staging\",\n				\"value\": \"all\",\n				\"env\": [\n					\"staging\"\n				]\n			}\n		]\n	},\n	{\n		\"cname\": \"启动前执行命令\",\n		\"pname\": \"init_scripts\",\n		\"type\": \"textarea\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"PVC\",\n		\"pname\": \"_pipeline.pvcs\",\n		\"type\": \"input\",\n		\"required\": false\n	},\n	{\n		\"cname\": \"configMap\",\n		\"pname\": \"_pipeline.configmaps\",\n		\"type\": \"select\",\n		\"required\": false,\n		\"validatorEmitterKey\": \"checkConfigMapForm\",\n		\"validator\": \"function(value) {let isValid=true; let data=[]; if(value && typeof value==\'string\'){data=JSON.parse(value);}else{data=value;}if (!data.length) return isValid;data.forEach(item=>{ if(item.conigMapName&&!item.ref.length){ isValid=false; }else if(item.ref.length){ item.ref.forEach(item2=>{ if(!item2.mountPath||!new RegExp(\'^/\').test(item2.mountPath)){ isValid=false; }})}}); return isValid;}\",\n		\"ajax\": {\n			\"ajaxUrl\": \"https://miline.test.mi.com/api/miline/k8s/configMap/list\",\n			\"ajaxType\": \"GET\",\n			\"ajaxParams\": \"{\\\"projectId\\\":\\\"123\\\", \\\"env\\\":\\\"staging\\\"}\"\n		}\n	}\n]', 1, 1659514499640, 1681983660952, NULL, NULL);
INSERT INTO `miline_step` VALUES (183948, 'webhookNotifyStepService', 'webhook通知', '[\n	{\n		\"cname\": \"webhook地址\",\n		\"pname\": \"webhookNotifyUrl\",\n		\"type\": \"textarea\",\n		\"required\": false,\n		\"reg\": \"^https?:\\\\/\\\\/([\\\\w.-]+)(\\\\/[\\\\w\\\\.-]*)*\\\\/?\",\n		\"regErrMsg\": \"请输入正确格式的网址\"\n	}\n]', 1, 1686122961601, 1689929187010, NULL, NULL);
COMMIT;

DROP TABLE IF EXISTS `miline_template`;
CREATE TABLE `miline_template` (
  `id` int(32) NOT NULL AUTO_INCREMENT,
  `language` varchar(64) DEFAULT '',
  `template_order` int(32) DEFAULT '0',
  `template_name` varchar(128) DEFAULT NULL,
  `template_cname` varchar(128) DEFAULT NULL,
  `desc` varchar(256) DEFAULT NULL,
  `group_order` int(32) DEFAULT '0',
  `group_name` varchar(128) DEFAULT NULL,
  `steps` json DEFAULT NULL,
  `extra_info` json DEFAULT NULL,
  `status` int(32) DEFAULT '0',
  `create_time` bigint(64) DEFAULT NULL,
  `update_time` bigint(64) DEFAULT NULL,
  `creator` varchar(64) DEFAULT NULL,
  `updater` varchar(64) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `k_group_order` (`group_order`,`template_order`,`status`),
  KEY `k_status` (`status`),
  KEY `k_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin AUTO_INCREMENT=142686;

BEGIN;
INSERT INTO `miline_template` VALUES (3, 'Java', 30001, 'MoneJavaCodecheck', 'Java代码扫描', 'Mone Java代码规约扫描', 30, 'CodeScan', '[\"mone_java_codecheck\"]', NULL, 1, 0, 1667987532779, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (4, '', 30002, 'SonarFrontEndCodecheck', 'Sonar前端代码扫描', 'Sonar前端代码扫描', 30, 'CodeScan', '[\"sonar_frontend_codecheck\"]', NULL, 0, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (5, 'Java', 30003, 'SonarJavaCodecheck', 'Sonar Java代码扫描', 'Sonar Java代码扫描', 30, 'CodeScan', '[\"sonar_java_codecheck\"]', NULL, 1, 0, 1649746953497, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (6, 'Java', 50001, 'JavaBuild', 'Java构建', 'Java构建，压缩包上传，用于脚本部署', 50, 'Build', '[\"java_build\"]', NULL, 1, 0, 1667987333967, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (7, '', 70001, 'MoneDeploy', '米效部署', '米效部署', 70, 'Deploy', '[\"mone_deploy\", \"webhookNotifyStepService\"]', NULL, 1, 0, 1686193406781, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (11, '', 1, 'ScriptExec', '脚本执行', '', 80, 'Cmd', '[\"scriptExec\"]', NULL, 1, 1646634894277, 1660719353067, NULL, NULL);
INSERT INTO `miline_template` VALUES (12, '', 10, 'NormativeCheck', '流程规范检查', '', 90, 'Other', '[\"normativeCheck\"]', NULL, 1, 1647411260520, 1647411277112, NULL, NULL);
INSERT INTO `miline_template` VALUES (13, '', 1, 'ServerlessHotUpdate', 'serverless热更新', '', 90, 'Other', '[\"serverlessHotUpdate\"]', NULL, 1, 1649314404034, 1649314404034, NULL, NULL);
INSERT INTO `miline_template` VALUES (17, '', 50002, 'StaticBuild', '静态资源构建', '静态资源构建', 50, 'Build', '[\"static_build\"]', NULL, 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52686, '', 60001, 'MoneImageBuild', '镜像构建', 'docker镜像构建', 60, 'ImageBuild', '[\"mone_image_build\"]', NULL, 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52688, '', 60002, 'DockerfileImageBuild', 'dockerfile镜像构建', 'dockerfile镜像构建', 60, 'ImageBuild', '[\"dockerfile_image_build\"]', NULL, 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52689, '', 70002, 'K8sDeploy', 'K8s部署', 'K8s部署', 70, 'Deploy', '[\"k8s_deploy\", \"webhookNotifyStepService\"]', NULL, 1, 0, 1686208096500, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52690, '', 90002, 'K8sJob', 'K8s Job', 'K8sJob', 90, 'Other', '[\"k8s_checkout\", \"k8s_maven_build\", \"k8s_java_image_build\", \"k8s_clean_workspace\", \"k8s_job\"]', NULL, 1, 0, 1652165168447, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52693, '', 90003, 'HttpRemote', '远程http服务', '远程http服务', 90, 'Other', '[\"http_remote\"]', NULL, 0, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52694, '', 90004, 'DubboInvoke', '远程dubbo服务', '远程dubbo服务', 90, 'Other', '[\"dubboInvoke\"]', NULL, 1, 0, 1649311675860, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (52695, '', 70003, 'StaticDeploy', '静态资源部署', '静态资源部署', 70, 'Deploy', '[\"static_deploy\"]', NULL, 1, NULL, NULL, 'admin', 'admin');
INSERT INTO `miline_template` VALUES (82686, '', 1, 'ScriptExecK8s', '脚本执行NEW', '', 80, 'Cmd', '[\"scriptExec\"]', NULL, 1, 1655970601402, 1660719362337, NULL, NULL);
INSERT INTO `miline_template` VALUES (82687, '', 70004, 'K8sBatchDeploy', 'k8s 灰度部署', 'k8s 分批部署', 70, 'Deploy', '[\"k8s_gray_deploy\", \"webhookNotifyStepService\"]', NULL, 1, 1659324070740, 1686208106377, NULL, NULL);
INSERT INTO `miline_template` VALUES (112686, '', 70004, 'FaasK8sBatchDeploy', 'mifaas k8s 灰度部署', 'mifaas k8s 灰度部署', 70, 'Deploy', '[\"mifaas_k8s_gray_deploy\", \"webhookNotifyStepService\"]', NULL, 1, 1661488118515, 1687228019980, NULL, NULL);
COMMIT;

DROP TABLE IF EXISTS `miline_template_group`;
CREATE TABLE `miline_template_group` (
  `id` int(32) NOT NULL AUTO_INCREMENT,
  `group_order` int(32) DEFAULT '0',
  `group_name` varchar(128) DEFAULT NULL,
  `group_cname` varchar(128) DEFAULT NULL,
  `desc` varchar(256) DEFAULT NULL,
  `create_time` bigint(64) DEFAULT NULL,
  `update_time` bigint(64) DEFAULT NULL,
  `creator` varchar(64) DEFAULT NULL,
  `updater` varchar(64) DEFAULT NULL,
  `status` int(4) DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `k_group_order` (`group_order`),
  KEY `k_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin AUTO_INCREMENT=60003;

BEGIN;
INSERT INTO `miline_template_group` VALUES (3, 10, 'Empty', '空模板', '空模板', NULL, NULL, 'admin', 'admin', 0);
INSERT INTO `miline_template_group` VALUES (4, 20, 'Branch', '分支管理', '分支管理', NULL, NULL, 'admin', 'admin', 0);
INSERT INTO `miline_template_group` VALUES (5, 30, 'CodeScan', '代码扫描', '代码扫描', NULL, NULL, 'admin', 'admin', 1);
INSERT INTO `miline_template_group` VALUES (6, 40, 'Test', '测试', '测试', NULL, NULL, 'admin', 'admin', 0);
INSERT INTO `miline_template_group` VALUES (7, 50, 'Build', '构建', '构建', NULL, NULL, 'admin', 'admin', 1);
INSERT INTO `miline_template_group` VALUES (8, 60, 'ImageBuild', '镜像构建', '镜像构建', NULL, NULL, 'admin', 'admin', 1);
INSERT INTO `miline_template_group` VALUES (9, 80, 'Cmd', '执行命令', '执行命令', NULL, NULL, 'admin', 'admin', 1);
INSERT INTO `miline_template_group` VALUES (10, 70, 'Deploy', '部署', '部署', NULL, NULL, 'admin', 'admin', 1);
INSERT INTO `miline_template_group` VALUES (11, 90, 'Other', '其它', '其它', NULL, NULL, 'admin', 'admin', 1);
COMMIT;


